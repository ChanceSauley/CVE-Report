import requests
from datetime import date, timedelta
import sys

REDHAT_API_URL = 'https://access.redhat.com/hydra/rest/securitydata/cve.json'

def output_data(data):
    print('CVE-ID,Severity,URL')
    for cve in data:
        print('%s,%s,https://bugzilla.redhat.com/show_bug.cgi?id=%s'
              % (cve['CVE'], cve['severity'], cve['bugzilla']))

two_weeks_ago = date.today() - timedelta(days=14)
params = '?after=' + str(two_weeks_ago)

query = REDHAT_API_URL + params
api_response = requests.get(query)

if api_response.status_code != 200:
    print("Error querying the API: %s" % REDHAT_API_URL)
    sys.exit(api_response)
else:
    data = api_response.json()
    output_data(data)
